generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id          Int           @id @default(autoincrement())
  email       String        @unique
  password    String
  firstName   String
  lastName    String
  phoneNumber String
  createdAt   DateTime      @default(now())
  account     BankAccount[]
}

model BankAccount {
  id                  Int           @id @default(autoincrement()) //hesabın kendi ID'si
  user                User          @relation(fields: [userId], references: [id]) // ② userId alanı User'dan id alanına bağlanması
  userId              Int // Bağlı olduğu kullanıcının ID'si (foreign key)
  name                String
  accountNumber       String        @unique
  iban                String        @unique
  balance             Float         @default(0.0)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  transactions        Transaction[] @relation("AccountTransactions")
  relatedTransactions Transaction[] @relation("RelatedAccountTransactions")
}

model Transaction {
  id               Int          @id @default(autoincrement())
  account          BankAccount  @relation("AccountTransactions", fields: [accountId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  accountId        Int
  type             String
  amount           Float
  description      String
  createdAt        DateTime     @default(now())
  relatedAccount   BankAccount? @relation("RelatedAccountTransactions", fields: [relatedAccountId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  relatedAccountId Int
}
